var pe=Object.defineProperty,ge=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var ae=(t,a,s)=>a in t?pe(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,se=(t,a)=>{for(var s in a||(a={}))we.call(a,s)&&ae(t,s,a[s]);if(ce)for(var s of ce(a))be.call(a,s)&&ae(t,s,a[s]);return t},ne=(t,a)=>ge(t,xe(a));var ve=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports);var D=(t,a,s)=>ae(t,typeof a!="symbol"?a+"":a,s);var j=(t,a,s)=>new Promise((n,r)=>{var c=m=>{try{i(s.next(m))}catch(f){r(f)}},d=m=>{try{i(s.throw(m))}catch(f){r(f)}},i=m=>m.done?n(m.value):Promise.resolve(m.value).then(c,d);i((s=s.apply(t,a)).next())});import{r as h,a as ye,R as je}from"./vendor-CpiCPt5m.js";import{B as V,f as ue,C as Ne,a as z,p as re}from"./ethers-DQgwCCQV.js";var Qe=ve(k=>{(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=s(r);fetch(r.href,c)}})();var me={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Se=h,Ce=Symbol.for("react.element"),Ee=Symbol.for("react.fragment"),Pe=Object.prototype.hasOwnProperty,Te=Se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ke={key:!0,ref:!0,__self:!0,__source:!0};function he(t,a,s){var n,r={},c=null,d=null;s!==void 0&&(c=""+s),a.key!==void 0&&(c=""+a.key),a.ref!==void 0&&(d=a.ref);for(n in a)Pe.call(a,n)&&!ke.hasOwnProperty(n)&&(r[n]=a[n]);if(t&&t.defaultProps)for(n in a=t.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:Ce,type:t,key:c,ref:d,props:r,_owner:Te.current}}X.Fragment=Ee;X.jsx=he;X.jsxs=he;me.exports=X;var e=me.exports,ie={},de=ye;ie.createRoot=de.createRoot,ie.hydrateRoot=de.hydrateRoot;const Fe=()=>e.jsxs("div",{className:"header",children:[e.jsx("h1",{className:"title",children:"üîê Credit Analyzer"}),e.jsx("p",{className:"subtitle",children:"Confidential Credit Evaluation using Fully Homomorphic Encryption"})]}),Ie=({userStatus:t,totalEvaluations:a,balance:s="0",networkName:n="Unknown",chainId:r=""})=>{const c=()=>t.hasSubmitted?t.isEvaluated?t.canApprove?"‚úÖ Request loan approval based on your score":"Credit evaluation complete!":"üîÑ Evaluate your credit score using encrypted computation":"üìù Submit your financial data for confidential evaluation",d=r==="0xaa36a7",i=parseFloat(s)===0;return e.jsxs("div",{className:"status-info",children:[e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Network:"}),e.jsxs("span",{className:`status-value ${d?"network-correct":"network-warning"}`,children:[n,!d&&r&&" ‚ö†Ô∏è"]})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"ETH Balance:"}),e.jsxs("span",{className:`status-value ${i?"balance-warning":""}`,children:[s," ETH",i&&" ‚ö†Ô∏è"]})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Data Submitted:"}),e.jsx("span",{className:"status-value",children:t.hasSubmitted?"‚úÖ Yes":"‚ùå No"})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Credit Evaluated:"}),e.jsx("span",{className:"status-value",children:t.isEvaluated?"‚úÖ Yes":"‚ùå No"})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Total Evaluations:"}),e.jsx("span",{className:"status-value",children:a})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Status:"}),e.jsx("span",{className:"status-value",children:c()})]}),!d&&r&&e.jsx("div",{className:"network-warning-message",children:"‚ö†Ô∏è Please switch to Sepolia testnet to use this DApp"}),i&&e.jsx("div",{className:"balance-warning-message",children:"‚ö†Ô∏è You need Sepolia ETH to pay for gas fees. Get free testnet ETH from a faucet."})]})},Ae=({onConnect:t,loading:a})=>{const s=()=>j(k,null,function*(){try{yield t()}catch(n){console.error("Connection failed:",n)}});return e.jsx("div",{className:"wallet-section",children:e.jsx("button",{className:"btn btn-primary",onClick:s,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Connecting..."]}):"Connect MetaMask Wallet"})})},Y=({presets:t,onSelect:a})=>e.jsx("div",{className:"preset-buttons",children:t.map((s,n)=>e.jsx("button",{type:"button",className:"preset-btn",onClick:()=>a(s.value),children:s.label},n))}),Le="0x40AAb767720Bc4BED4765b0F93B67bbBb6A98f51",Me=["function submitCreditData(uint32, uint32, uint8, uint8, uint8) external","function evaluateCreditScore(address) external","function requestLoanApproval() external","function getCreditScore(address) external view returns (uint8)","function getLoanApprovalStatus(address) external view returns (bool)","function hasSubmittedCreditData(address) external view returns (bool)","function isCreditEvaluated(address) external view returns (bool)","function getEvaluationStats() external view returns (uint256)","function updateCreditData(uint32, uint32, uint8, uint8, uint8) external","event CreditDataSubmitted(address indexed user, uint256 timestamp)","event CreditEvaluated(address indexed user, uint256 timestamp)","event LoanApprovalRequested(address indexed user, uint256 timestamp)"],R="0xaa36a7",Ge={chainId:R,chainName:"Sepolia Test Network",rpcUrls:["https://sepolia.infura.io/v3/","https://rpc.sepolia.org","https://ethereum-sepolia.blockpi.network/v1/rpc/public"],nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io/"]},_e=[{label:"$3,000",value:3e3},{label:"$5,000",value:5e3},{label:"$8,000",value:8e3},{label:"$12,000",value:12e3}],Re=[{label:"$0",value:0},{label:"$5,000",value:5e3},{label:"$15,000",value:15e3},{label:"$30,000",value:3e4}],$e=[{label:"25",value:25},{label:"30",value:30},{label:"40",value:40},{label:"50",value:50}],qe=[{label:"2 years",value:2},{label:"5 years",value:5},{label:"10 years",value:10},{label:"15+ years",value:15}],He=[{label:"5 - Fair",value:5},{label:"7 - Good",value:7},{label:"9 - Excellent",value:9},{label:"10 - Perfect",value:10}],De=({creditData:t,setCreditData:a,setPreset:s,onSubmit:n,loading:r})=>{const c=(i,m)=>{a(f=>ne(se({},f),{[i]:m}))},d=()=>j(k,null,function*(){try{yield n()}catch(i){console.error("Submit failed:",i)}});return e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Submit Confidential Credit Data"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Monthly Income (USD)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Enter monthly income",value:t.income,onChange:i=>c("income",i.target.value),disabled:r}),e.jsx(Y,{presets:_e,onSelect:i=>s("income",i.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Total Debt (USD)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Enter total debt",value:t.debt,onChange:i=>c("debt",i.target.value),disabled:r}),e.jsx(Y,{presets:Re,onSelect:i=>s("debt",i.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Age"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Enter your age",min:"18",max:"100",value:t.age,onChange:i=>c("age",i.target.value),disabled:r}),e.jsx(Y,{presets:$e,onSelect:i=>s("age",i.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Credit History (Years)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Years of credit history",min:"0",value:t.creditHistory,onChange:i=>c("creditHistory",i.target.value),disabled:r}),e.jsx(Y,{presets:qe,onSelect:i=>s("creditHistory",i.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Payment History Score (1-10)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Payment reliability score",min:"1",max:"10",value:t.paymentHistory,onChange:i=>c("paymentHistory",i.target.value),disabled:r}),e.jsx(Y,{presets:He,onSelect:i=>s("paymentHistory",i.toString())})]}),e.jsx("button",{className:"btn btn-primary",onClick:d,disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Submitting..."]}):"Submit Encrypted Data to Blockchain"})]})},Be=({userStatus:t,onEvaluate:a,onRequestApproval:s,loading:n})=>{const r=()=>j(k,null,function*(){try{yield a()}catch(d){console.error("Evaluation failed:",d)}}),c=()=>j(k,null,function*(){try{yield s()}catch(d){console.error("Approval request failed:",d)}});return e.jsxs("div",{className:"action-buttons",children:[t.hasSubmitted&&!t.isEvaluated&&e.jsx("button",{className:"btn btn-secondary",onClick:r,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Evaluating..."]}):"Evaluate Credit Score with FHE"}),t.canApprove&&e.jsx("button",{className:"btn btn-accent",onClick:c,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Requesting..."]}):"Request Loan Approval"})]})},Oe=({message:t,type:a,onClose:s})=>t?e.jsxs("div",{className:`message ${a==="error"?"error":""}`,children:[e.jsx("span",{children:t}),a==="error"&&e.jsx("button",{className:"message-close",onClick:s,"aria-label":"Close message",children:"√ó"})]}):null,Ue=({status:t,onClose:a})=>{if(!t)return null;const s=()=>{switch(t.status){case"pending":return"‚è≥";case"confirming":return"üîÑ";case"confirmed":return"‚úÖ";case"failed":return"‚ùå";default:return"üìã"}},n=()=>{switch(t.status){case"pending":return"#fbbf24";case"confirming":return"#3b82f6";case"confirmed":return"#10b981";case"failed":return"#ef4444";default:return"#6b7280"}},r=()=>{switch(t.status){case"pending":return"Waiting for user confirmation...";case"confirming":return`Confirming... (${t.confirmations} confirmation${t.confirmations!==1?"s":""})`;case"confirmed":return"Transaction confirmed!";case"failed":return t.error||"Transaction failed";default:return"Unknown status"}};return e.jsxs("div",{className:"transaction-status",style:{borderLeftColor:n()},children:[e.jsxs("div",{className:"transaction-header",children:[e.jsx("span",{className:"status-icon",children:s()}),e.jsx("span",{className:"status-text",children:r()}),a&&(t.status==="confirmed"||t.status==="failed")&&e.jsx("button",{className:"close-btn",onClick:a,children:"√ó"})]}),t.hash&&e.jsxs("div",{className:"transaction-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Transaction Hash:"}),e.jsxs("a",{href:`https://sepolia.etherscan.io/tx/${t.hash}`,target:"_blank",rel:"noopener noreferrer",className:"transaction-link",children:[t.hash.slice(0,10),"...",t.hash.slice(-8)]})]}),t.blockNumber&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Block Number:"}),e.jsx("span",{className:"detail-value",children:t.blockNumber})]}),t.gasUsed&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Gas Used:"}),e.jsx("span",{className:"detail-value",children:parseInt(t.gasUsed).toLocaleString()})]}),t.effectiveGasPrice&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Gas Price:"}),e.jsxs("span",{className:"detail-value",children:[parseFloat(t.effectiveGasPrice).toFixed(2)," gwei"]})]})]}),t.status==="pending"&&e.jsxs("div",{className:"pending-info",children:[e.jsx("p",{children:"Please confirm the transaction in your MetaMask wallet."}),e.jsxs("div",{className:"loading-dots",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]}),t.status==="confirming"&&e.jsxs("div",{className:"confirming-info",children:[e.jsx("p",{children:"Transaction is being processed on the Sepolia network."}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(t.confirmations*100,100)}%`}})})]})]})},We=()=>e.jsxs("div",{className:"footer",children:[e.jsx("p",{children:"üõ°Ô∏è All data encrypted using Zama's FHE technology"}),e.jsx("p",{children:"Privacy-first credit scoring on Sepolia testnet"})]}),Ye=()=>{const[t,a]=h.useState(null),[s,n]=h.useState(null),[r,c]=h.useState(null),[d,i]=h.useState(!1),[m,f]=h.useState(!1),[x,w]=h.useState("0"),[N,C]=h.useState(""),[G,F]=h.useState("");h.useEffect(()=>{if($(),window.ethereum){const o=p=>{console.log("üë§ Account changed:",p[0]||"disconnected"),p.length===0?M():p[0]!==t&&(a(p[0]),L(p[0]))},b=p=>{console.log("üåê Chain changed:",p),C(p),S(p),p!==R&&console.warn("‚ö†Ô∏è Not connected to Sepolia testnet")},v=p=>{console.log("üîó Wallet connected:",p),$()},y=()=>{console.log("‚ùå Wallet disconnected"),M()};return window.ethereum.on("accountsChanged",o),window.ethereum.on("chainChanged",b),window.ethereum.on("connect",v),window.ethereum.on("disconnect",y),()=>{var p,E,g,P;(p=window.ethereum)==null||p.removeListener("accountsChanged",o),(E=window.ethereum)==null||E.removeListener("chainChanged",b),(g=window.ethereum)==null||g.removeListener("connect",v),(P=window.ethereum)==null||P.removeListener("disconnect",y)}}},[t]);const L=h.useCallback(o=>j(k,null,function*(){if(!(!window.ethereum||!o))try{const v=yield new V(window.ethereum).getBalance(o),y=ue(v);w(parseFloat(y).toFixed(4))}catch(b){console.error("Failed to update account info:",b),w("0")}}),[]),S=h.useCallback(o=>{F({"0x1":"Ethereum Mainnet","0xaa36a7":"Sepolia Testnet","0x5":"Goerli Testnet","0x7a69":"Hardhat Local"}[o]||`Unknown Network (${o})`)},[]),$=()=>j(k,null,function*(){if(!window.ethereum){console.log("üö´ MetaMask not detected");return}try{console.log("üîç Checking existing wallet connection...");const o=yield window.ethereum.request({method:"eth_accounts"});if(o.length>0){console.log("‚úÖ Wallet already connected:",o[0]);const b=yield window.ethereum.request({method:"eth_chainId"});C(b),S(b);const v=new V(window.ethereum),y=yield v.getSigner();n(v),c(y),a(o[0]),f(!0),yield L(o[0])}}catch(o){console.error("‚ùå Error checking wallet connection:",o)}}),_=()=>j(k,null,function*(){if(!window.ethereum)throw new Error("üö´ MetaMask not detected! Please install MetaMask to use this DApp.");try{i(!0),console.log("üîó Requesting wallet connection...");const o=yield window.ethereum.request({method:"eth_requestAccounts"});if(o.length===0)throw new Error("‚ùå No accounts found. Please unlock MetaMask.");console.log("‚úÖ Account connected:",o[0]);const b=yield window.ethereum.request({method:"eth_chainId"});console.log("üåê Current network:",b),C(b),S(b),b!==R&&(console.log("‚ö†Ô∏è Not on Sepolia, attempting to switch..."),yield q()),console.log("üì° Initializing Web3 provider...");const v=new V(window.ethereum),y=yield v.getSigner();if((yield y.getAddress()).toLowerCase()!==o[0].toLowerCase())throw new Error("‚ùå Signer address mismatch");n(v),c(y),a(o[0]),f(!0),yield L(o[0]),console.log("üéâ Wallet connection successful!")}catch(o){throw console.error("‚ùå Wallet connection failed:",o),f(!1),o}finally{i(!1)}}),q=()=>j(k,null,function*(){try{console.log("üîÑ Switching to Sepolia testnet...");try{yield window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:R}]}),console.log("‚úÖ Successfully switched to Sepolia"),C(R),S(R)}catch(o){if(console.log("Switch error code:",o.code),o.code===4902)console.log("‚ûï Adding Sepolia network to MetaMask..."),yield window.ethereum.request({method:"wallet_addEthereumChain",params:[Ge]}),console.log("‚úÖ Sepolia network added successfully"),C(R),S(R);else throw o.code===4001?new Error("‚ùå User rejected network switch. Please switch to Sepolia testnet manually."):o}}catch(o){throw console.error("‚ùå Error switching to Sepolia:",o),new Error(`Failed to switch to Sepolia testnet: ${o.message}`)}}),M=()=>{console.log("üîå Disconnecting wallet..."),a(null),n(null),c(null),f(!1),w("0"),C(""),F("")};return{account:t,provider:s,signer:r,loading:d,isConnected:m,balance:x,chainId:N,networkName:G,connectWallet:_,disconnect:M,switchToSepolia:q,requestPermissions:()=>j(k,null,function*(){try{const o=yield window.ethereum.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]});return console.log("üîë Permissions granted:",o),o}catch(o){throw console.error("‚ùå Permission request failed:",o),o}}),updateAccountInfo:L}},ze=({isOpen:t,onClose:a})=>{const[s,n]=h.useState("flow");return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"üîç MetaMask Transaction Implementation Principles"}),e.jsx("button",{className:"modal-close",onClick:a,children:"‚úï"})]}),e.jsxs("div",{className:"modal-tabs",children:[e.jsx("button",{className:`tab-btn ${s==="flow"?"active":""}`,onClick:()=>n("flow"),children:"Contract Interaction Flow"}),e.jsx("button",{className:`tab-btn ${s==="trigger"?"active":""}`,onClick:()=>n("trigger"),children:"Trigger Mechanism"}),e.jsx("button",{className:`tab-btn ${s==="state"?"active":""}`,onClick:()=>n("state"),children:"State Management"})]}),e.jsxs("div",{className:"modal-body",children:[s==="flow"&&e.jsxs("div",{className:"explanation-section",children:[e.jsx("h3",{children:"üìã Contract Interaction Flow:"}),e.jsxs("div",{className:"flow-steps",children:[e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"1"}),e.jsx("span",{className:"step-text",children:"User clicks button"})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"2"}),e.jsx("span",{className:"step-text",children:"Call contract method"})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"3"}),e.jsx("span",{className:"step-text",children:"ethers.js sends transaction"})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"4"}),e.jsx("span",{className:"step-text",children:"MetaMask popup confirmation"})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"5"}),e.jsx("span",{className:"step-text",children:"Blockchain execution"})]})]})]}),s==="trigger"&&e.jsxs("div",{className:"explanation-section",children:[e.jsx("h3",{children:"‚ö° Trigger Mechanism:"}),e.jsxs("ol",{className:"numbered-list",children:[e.jsx("li",{children:"When contract method is called, ethers.js constructs the transaction"}),e.jsx("li",{children:"Because contract instance uses signer, ethers.js knows user signature is required"}),e.jsx("li",{children:"This automatically triggers MetaMask transaction confirmation popup"}),e.jsx("li",{children:"After user confirmation, transaction is sent to Sepolia testnet"}),e.jsxs("li",{children:[e.jsx("code",{children:"tx.wait()"})," waits for transaction to be mined and confirmed"]})]})]}),s==="state"&&e.jsxs("div",{className:"explanation-section",children:[e.jsx("h3",{children:"üîÑ State Management:"}),e.jsxs("ul",{className:"bullet-list",children:[e.jsx("li",{children:"Display loading state during transaction processing"}),e.jsx("li",{children:"Update UI prompts and user feedback"}),e.jsx("li",{children:"Wait for blockchain confirmation"}),e.jsx("li",{children:"Refresh page state after transaction completion"})]})]}),e.jsxs("div",{className:"technical-summary",children:[e.jsx("h4",{children:"üí° Technical Implementation:"}),e.jsx("p",{children:"Interaction with smart contracts is handled through ethers.js, with MetaMask as the wallet provider automatically handling transaction signing and sending."})]})]})]})}):null},Ke=t=>{const[a,s]=h.useState(null),[n,r]=h.useState(!1);h.useEffect(()=>{t&&window.ethereum?c():s(null)},[t]);const c=()=>j(k,null,function*(){try{r(!0);const i=yield new V(window.ethereum).getSigner(),m=new Ne(Le,Me,i);s(m)}catch(d){console.error("Failed to initialize contract:",d),s(null)}finally{r(!1)}});return{contract:a,loading:n}};class Je{constructor(a){D(this,"provider");this.provider=a}trackTransaction(a,s){return j(this,null,function*(){console.log("üì° Tracking transaction:",a),s({hash:a,status:"pending",confirmations:0});try{const n=yield this.provider.waitForTransaction(a,1);if(!n)throw new Error("Transaction receipt not found");return console.log("‚úÖ Transaction confirmed:",{hash:a,blockNumber:n.blockNumber,gasUsed:n.gasUsed.toString(),status:n.status}),s({hash:a,status:n.status===1?"confirmed":"failed",confirmations:1,gasUsed:z(n.gasUsed,"wei"),effectiveGasPrice:n.gasPrice?z(n.gasPrice,"gwei"):void 0,blockNumber:n.blockNumber}),n}catch(n){throw console.error("‚ùå Transaction tracking failed:",n),s({hash:a,status:"failed",confirmations:0,error:n.message}),n}})}}class Ve{constructor(a){D(this,"provider");this.provider=a}estimateContractCall(r,c){return j(this,arguments,function*(a,s,n=[]){try{console.log(`‚õΩ Estimating gas for ${s}...`),console.log("üìù Arguments for estimation:",n);const d=yield this.provider.getFeeData();console.log("üí∞ Fee data:",{gasPrice:d.gasPrice?z(d.gasPrice,"gwei"):"null",maxFeePerGas:d.maxFeePerGas?z(d.maxFeePerGas,"gwei"):"null",maxPriorityFeePerGas:d.maxPriorityFeePerGas?z(d.maxPriorityFeePerGas,"gwei"):"null"});let i;try{i=yield a[s].estimateGas(...n),console.log(`üìä Estimated gas limit: ${i.toString()}`)}catch(G){console.warn("‚ö†Ô∏è Gas estimation failed, trying fallback methods:",G.message);try{yield a[s].staticCall(...n),console.log("‚úÖ Static call succeeded, using fallback gas limit"),i=BigInt(3e5)}catch(F){throw console.error("‚ùå Static call also failed:",F.message),new Error(`Contract call would fail: ${F.message}`)}}const m=i*BigInt(150)/BigInt(100);let f=d.gasPrice||BigInt(0),x=d.maxFeePerGas,w=d.maxPriorityFeePerGas;!f&&!x&&(f=BigInt(re("20","gwei")),x=f),!x&&f>BigInt(0)&&(x=f);const N=m*(x||f),C=ue(N);return console.log(`üí∏ Estimated cost: ${C} ETH`),{gasLimit:m,gasPrice:f,maxFeePerGas:x||void 0,maxPriorityFeePerGas:w||void 0,estimatedCost:parseFloat(C).toFixed(6)}}catch(d){console.error(`‚ùå Gas estimation failed for ${s}:`,d);const i=BigInt(re("25","gwei"));return{gasLimit:BigInt(4e5),gasPrice:i,maxFeePerGas:i,maxPriorityFeePerGas:BigInt(re("2","gwei")),estimatedCost:"0.01"}}})}}class Xe{constructor(a){D(this,"provider");D(this,"gasEstimator");D(this,"transactionTracker");this.provider=a,this.gasEstimator=new Ve(a),this.transactionTracker=new Je(a)}executeTransaction(d,i){return j(this,arguments,function*(a,s,n=[],r,c={}){var C,G,F,L,S,$,_,q,M,B,o,b,v,y,p;const{confirmations:m=1,timeout:f=3e5,retries:x=1}=c;let w=null;for(let E=0;E<=x;E++)try{E>0&&(console.log(`üîÑ Retry attempt ${E}/${x} for ${s}`),yield new Promise(Q=>setTimeout(Q,1e3))),console.log(`üöÄ Executing transaction: ${s} (attempt ${E+1})`),console.log("üìù Arguments:",n);const g=yield this.gasEstimator.estimateContractCall(a,s,n);console.log("‚õΩ Gas estimate:",g),r({status:"pending",confirmations:0});const P={gasLimit:g.gasLimit};g.maxFeePerGas&&g.maxPriorityFeePerGas?(P.maxFeePerGas=g.maxFeePerGas,P.maxPriorityFeePerGas=g.maxPriorityFeePerGas):g.gasPrice&&(P.gasPrice=g.gasPrice),console.log("üì§ Sending transaction to blockchain..."),console.log("‚öôÔ∏è Transaction options:",{gasLimit:(C=P.gasLimit)==null?void 0:C.toString(),gasPrice:(G=P.gasPrice)==null?void 0:G.toString(),maxFeePerGas:(F=P.maxFeePerGas)==null?void 0:F.toString(),maxPriorityFeePerGas:(L=P.maxPriorityFeePerGas)==null?void 0:L.toString()});const I=yield a[s](...n,P);console.log("‚úÖ Transaction sent:",I.hash),console.log("üìã Transaction details:",{to:I.to,value:((S=I.value)==null?void 0:S.toString())||"0",gasLimit:(($=I.gasLimit)==null?void 0:$.toString())||"unknown",gasPrice:(_=I.gasPrice)==null?void 0:_.toString(),maxFeePerGas:(q=I.maxFeePerGas)==null?void 0:q.toString(),nonce:I.nonce});const Z=yield this.transactionTracker.trackTransaction(I.hash,r);return console.log("üéâ Transaction completed successfully!"),Z}catch(g){if(w=g,console.error(`‚ùå Transaction execution failed for ${s} (attempt ${E+1}):`,g),g.code===4001||(M=g.message)!=null&&M.includes("user rejected")||(B=g.message)!=null&&B.includes("cancelled by user")||E===x)break}let N=w.message;throw w.code===4001?N="Transaction cancelled by user":w.code===-32603?N="Transaction failed - insufficient funds or contract error":(o=w.message)!=null&&o.includes("insufficient funds")?N="Insufficient ETH balance for gas fees":(b=w.message)!=null&&b.includes("user rejected")?N="Transaction rejected by user":(v=w.message)!=null&&v.includes("execution reverted")?N="Contract execution failed - check your data":(y=w.message)!=null&&y.includes("missing revert data")?N="Contract call failed - please check your input data and try again":(p=w.message)!=null&&p.includes("CALL_EXCEPTION")&&(N="Contract call exception - please verify your data is correct"),r({status:"failed",confirmations:0,error:N}),new Error(N)})}}function Ze(){const{account:t,isConnected:a,connectWallet:s,balance:n,chainId:r,networkName:c,loading:d,provider:i}=Ye(),{contract:m,loading:f}=Ke(t),[x,w]=h.useState({income:"",debt:"",age:"",creditHistory:"",paymentHistory:""}),[N,C]=h.useState({hasSubmitted:!1,isEvaluated:!1,canApprove:!1}),[G,F]=h.useState(0),[L,S]=h.useState(!1),[$,_]=h.useState(""),[q,M]=h.useState(!1),[B,o]=h.useState("info"),[b,v]=h.useState(null),[y,p]=h.useState(null);h.useEffect(()=>{if(i){const l=new Xe(i);p(l)}},[i]),h.useEffect(()=>{m&&t&&(g(),P())},[m,t]);const E=()=>{v(null)},g=()=>j(this,null,function*(){if(!(!m||!t))try{const l=yield m.hasSubmittedCreditData(t),A=yield m.isCreditEvaluated(t);C({hasSubmitted:l,isEvaluated:A,canApprove:A})}catch(l){console.error("Failed to update user status:",l)}}),P=()=>j(this,null,function*(){if(m)try{const l=yield m.getEvaluationStats();F(Number(l))}catch(l){console.error("Failed to update stats:",l)}}),I=()=>j(this,null,function*(){if(!m||!y){u("Please connect your wallet first!","error");return}const l=x.income.trim(),A=x.debt.trim(),K=x.age.trim(),oe=x.creditHistory.trim(),le=x.paymentHistory.trim();if(!l||!A||!K||!oe||!le){u("Please fill in all fields!","error");return}const H=parseInt(l),O=parseInt(A),U=parseInt(K),J=parseInt(oe),W=parseInt(le);if(isNaN(H)||isNaN(O)||isNaN(U)||isNaN(J)||isNaN(W)){u("Please enter valid numbers for all fields!","error");return}if(U<18||U>100){u("Age must be between 18 and 100!","error");return}if(W<1||W>10){u("Payment history score must be between 1 and 10!","error");return}if(H<=0){u("Income must be greater than 0!","error");return}if(O<0){u("Debt cannot be negative!","error");return}if(J<0){u("Credit history cannot be negative!","error");return}if(H>1e7){u("Income seems unusually high. Please verify your input.","error");return}if(O>H*100){u("Debt amount seems unusually high compared to income.","error");return}if(parseFloat(n)===0){u("Insufficient ETH balance to pay for gas fees. Please add Sepolia ETH to your wallet.","error");return}try{S(!0),E(),u("Preparing transaction..."),console.log("üöÄ Starting credit data submission transaction"),console.log("üìã Validated data:",{income:H,debt:O,age:U,creditHistory:J,paymentHistory:W}),yield y.executeTransaction(m,"submitCreditData",[H,O,U,J,W],T=>{console.log("üìä Transaction status update:",T),v(T),T.status==="pending"?u("Transaction sent! Please confirm in MetaMask..."):T.status==="confirming"?u(`Transaction confirming... (${T.confirmations} confirmations)`):T.status==="confirmed"?u("Credit data successfully submitted to blockchain! üü¢"):T.status==="failed"&&u(T.error||"Transaction failed","error")},{retries:2,confirmations:1}),w({income:"",debt:"",age:"",creditHistory:"",paymentHistory:""}),yield g(),console.log("‚úÖ Credit data submission completed successfully")}catch(T){console.error("‚ùå Submit credit data failed:",T);let te=T.message;te.includes("Contract call would fail")&&(te="Transaction would fail. Please check if you have already submitted data or verify your input values."),u(te||"Failed to submit credit data. Please try again.","error")}finally{S(!1)}}),Z=()=>j(this,null,function*(){if(!m||!t||!y){u("Please ensure wallet and contract are connected!","error");return}if(parseFloat(n)===0){u("Insufficient ETH balance to pay for gas fees.","error");return}try{S(!0),E(),u("Preparing credit evaluation..."),console.log("üß† Starting credit evaluation transaction for:",t),yield y.executeTransaction(m,"evaluateCreditScore",[t],l=>{console.log("üìä Evaluation status update:",l),v(l),l.status==="pending"?u("Transaction sent! Please confirm in MetaMask..."):l.status==="confirming"?u("Computing encrypted credit score..."):l.status==="confirmed"?u("Credit evaluation completed using homomorphic encryption! üü¢"):l.status==="failed"&&u(l.error||"Evaluation failed","error")}),yield g(),yield P(),console.log("‚úÖ Credit evaluation completed successfully")}catch(l){console.error("‚ùå Credit evaluation failed:",l),u(l.message||"Failed to evaluate credit score. Please try again.","error")}finally{S(!1)}}),Q=()=>j(this,null,function*(){if(!m||!y){u("Please ensure wallet and contract are connected!","error");return}if(parseFloat(n)===0){u("Insufficient ETH balance to pay for gas fees.","error");return}try{S(!0),E(),u("Preparing loan approval request..."),console.log("üí∞ Starting loan approval request transaction"),yield y.executeTransaction(m,"requestLoanApproval",[],l=>{console.log("üìä Approval status update:",l),v(l),l.status==="pending"?u("Transaction sent! Please confirm in MetaMask..."):l.status==="confirming"?u("Processing loan approval request..."):l.status==="confirmed"?u("Loan approval request submitted successfully! üü¢"):l.status==="failed"&&u(l.error||"Approval request failed","error")}),console.log("‚úÖ Loan approval request completed successfully")}catch(l){console.error("‚ùå Loan approval request failed:",l),u(l.message||"Failed to request loan approval. Please try again.","error")}finally{S(!1)}}),u=(l,A="info")=>{_(l),o(A),A!=="error"&&setTimeout(()=>{_("")},5e3)},fe=(l,A)=>{w(K=>ne(se({},K),{[l]:A}))},ee=d||f||L;return e.jsxs("div",{className:"container",children:[e.jsx(Fe,{}),e.jsx(Ie,{userStatus:N,totalEvaluations:G,balance:n,networkName:c,chainId:r}),e.jsx("div",{className:"explanation-btn-container",children:e.jsx("button",{className:"btn btn-accent explanation-btn",onClick:()=>M(!0),children:"üìö Transaction Explanation"})}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"wallet-address",children:["Connected: ",t==null?void 0:t.slice(0,6),"...",t==null?void 0:t.slice(-4)]}),!N.hasSubmitted&&e.jsx(De,{creditData:x,setCreditData:w,setPreset:fe,onSubmit:I,loading:ee}),e.jsx(Be,{userStatus:N,onEvaluate:Z,onRequestApproval:Q,loading:ee})]}):e.jsx(Ae,{onConnect:s,loading:ee}),e.jsx(Oe,{message:$,type:B,onClose:()=>_("")}),e.jsx(Ue,{status:b,onClose:()=>v(null)}),e.jsx(ze,{isOpen:q,onClose:()=>M(!1)}),e.jsx(We,{})]})}ie.createRoot(document.getElementById("root")).render(e.jsx(je.StrictMode,{children:e.jsx(Ze,{})}))});export default Qe();
