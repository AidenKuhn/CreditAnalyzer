var ae=Object.defineProperty;var se=(t,a,r)=>a in t?ae(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;var L=(t,a,r)=>(se(t,typeof a!="symbol"?a+"":a,r),r);import{r as h,a as ne,R as re}from"./vendor-Dt8B4mpO.js";import{B as O,f as J,C as oe,a as H,p as ie}from"./ethers-B1GBji2H.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();var Z={exports:{}},U={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var le=h,ce=Symbol.for("react.element"),de=Symbol.for("react.fragment"),ue=Object.prototype.hasOwnProperty,me=le.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,he={key:!0,ref:!0,__self:!0,__source:!0};function Q(t,a,r){var s,n={},c=null,u=null;r!==void 0&&(c=""+r),a.key!==void 0&&(c=""+a.key),a.ref!==void 0&&(u=a.ref);for(s in a)ue.call(a,s)&&!he.hasOwnProperty(s)&&(n[s]=a[s]);if(t&&t.defaultProps)for(s in a=t.defaultProps,a)n[s]===void 0&&(n[s]=a[s]);return{$$typeof:ce,type:t,key:c,ref:u,props:n,_owner:me.current}}U.Fragment=de;U.jsx=Q;U.jsxs=Q;Z.exports=U;var e=Z.exports,Y={},K=ne;Y.createRoot=K.createRoot,Y.hydrateRoot=K.hydrateRoot;const pe=()=>e.jsxs("div",{className:"header",children:[e.jsx("h1",{className:"title",children:"🔐 Credit Analyzer"}),e.jsx("p",{className:"subtitle",children:"Confidential Credit Evaluation using Fully Homomorphic Encryption"})]}),fe=({userStatus:t,totalEvaluations:a,balance:r="0",networkName:s="Unknown",chainId:n=""})=>{const c=()=>t.hasSubmitted?t.isEvaluated?t.canApprove?"✅ Request loan approval based on your score":"Credit evaluation complete!":"🔄 Evaluate your credit score using encrypted computation":"📝 Submit your financial data for confidential evaluation",u=n==="0xaa36a7",o=parseFloat(r)===0;return e.jsxs("div",{className:"status-info",children:[e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Network:"}),e.jsxs("span",{className:`status-value ${u?"network-correct":"network-warning"}`,children:[s,!u&&n&&" ⚠️"]})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"ETH Balance:"}),e.jsxs("span",{className:`status-value ${o?"balance-warning":""}`,children:[r," ETH",o&&" ⚠️"]})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Data Submitted:"}),e.jsx("span",{className:"status-value",children:t.hasSubmitted?"✅ Yes":"❌ No"})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Credit Evaluated:"}),e.jsx("span",{className:"status-value",children:t.isEvaluated?"✅ Yes":"❌ No"})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Total Evaluations:"}),e.jsx("span",{className:"status-value",children:a})]}),e.jsxs("div",{className:"status-row",children:[e.jsx("span",{className:"status-label",children:"Status:"}),e.jsx("span",{className:"status-value",children:c()})]}),!u&&n&&e.jsx("div",{className:"network-warning-message",children:"⚠️ Please switch to Sepolia testnet to use this DApp"}),o&&e.jsx("div",{className:"balance-warning-message",children:"⚠️ You need Sepolia ETH to pay for gas fees. Get free testnet ETH from a faucet."})]})},ge=({onConnect:t,loading:a})=>{const r=async()=>{try{await t()}catch(s){console.error("Connection failed:",s)}};return e.jsx("div",{className:"wallet-section",children:e.jsx("button",{className:"btn btn-primary",onClick:r,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Connecting..."]}):"Connect MetaMask Wallet"})})},G=({presets:t,onSelect:a})=>e.jsx("div",{className:"preset-buttons",children:t.map((r,s)=>e.jsx("button",{type:"button",className:"preset-btn",onClick:()=>a(r.value),children:r.label},s))}),xe="0x40AAb767720Bc4BED4765b0F93B67bbBb6A98f51",we=["function submitCreditData(uint32, uint32, uint8, uint8, uint8) external","function evaluateCreditScore(address) external","function requestLoanApproval() external","function getCreditScore(address) external view returns (uint8)","function getLoanApprovalStatus(address) external view returns (bool)","function hasSubmittedCreditData(address) external view returns (bool)","function isCreditEvaluated(address) external view returns (bool)","function getEvaluationStats() external view returns (uint256)","function updateCreditData(uint32, uint32, uint8, uint8, uint8) external","event CreditDataSubmitted(address indexed user, uint256 timestamp)","event CreditEvaluated(address indexed user, uint256 timestamp)","event LoanApprovalRequested(address indexed user, uint256 timestamp)"],T="0xaa36a7",ve={chainId:T,chainName:"Sepolia Test Network",rpcUrls:["https://sepolia.infura.io/v3/","https://rpc.sepolia.org","https://ethereum-sepolia.blockpi.network/v1/rpc/public"],nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io/"]},be=[{label:"$3,000",value:3e3},{label:"$5,000",value:5e3},{label:"$8,000",value:8e3},{label:"$12,000",value:12e3}],je=[{label:"$0",value:0},{label:"$5,000",value:5e3},{label:"$15,000",value:15e3},{label:"$30,000",value:3e4}],ye=[{label:"25",value:25},{label:"30",value:30},{label:"40",value:40},{label:"50",value:50}],Ne=[{label:"2 years",value:2},{label:"5 years",value:5},{label:"10 years",value:10},{label:"15+ years",value:15}],Se=[{label:"5 - Fair",value:5},{label:"7 - Good",value:7},{label:"9 - Excellent",value:9},{label:"10 - Perfect",value:10}],Ce=({creditData:t,setCreditData:a,setPreset:r,onSubmit:s,loading:n})=>{const c=(o,m)=>{a(j=>({...j,[o]:m}))},u=async()=>{try{await s()}catch(o){console.error("Submit failed:",o)}};return e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Submit Confidential Credit Data"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Monthly Income (USD)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Enter monthly income",value:t.income,onChange:o=>c("income",o.target.value),disabled:n}),e.jsx(G,{presets:be,onSelect:o=>r("income",o.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Total Debt (USD)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Enter total debt",value:t.debt,onChange:o=>c("debt",o.target.value),disabled:n}),e.jsx(G,{presets:je,onSelect:o=>r("debt",o.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Age"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Enter your age",min:"18",max:"100",value:t.age,onChange:o=>c("age",o.target.value),disabled:n}),e.jsx(G,{presets:ye,onSelect:o=>r("age",o.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Credit History (Years)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Years of credit history",min:"0",value:t.creditHistory,onChange:o=>c("creditHistory",o.target.value),disabled:n}),e.jsx(G,{presets:Ne,onSelect:o=>r("creditHistory",o.toString())})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Payment History Score (1-10)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Payment reliability score",min:"1",max:"10",value:t.paymentHistory,onChange:o=>c("paymentHistory",o.target.value),disabled:n}),e.jsx(G,{presets:Se,onSelect:o=>r("paymentHistory",o.toString())})]}),e.jsx("button",{className:"btn btn-primary",onClick:u,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Submitting..."]}):"Submit Encrypted Data to Blockchain"})]})},Ee=({userStatus:t,onEvaluate:a,onRequestApproval:r,loading:s})=>{const n=async()=>{try{await a()}catch(u){console.error("Evaluation failed:",u)}},c=async()=>{try{await r()}catch(u){console.error("Approval request failed:",u)}};return e.jsxs("div",{className:"action-buttons",children:[t.hasSubmitted&&!t.isEvaluated&&e.jsx("button",{className:"btn btn-secondary",onClick:n,disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Evaluating..."]}):"Evaluate Credit Score with FHE"}),t.canApprove&&e.jsx("button",{className:"btn btn-accent",onClick:c,disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading"}),"Requesting..."]}):"Request Loan Approval"})]})},Pe=({message:t,type:a,onClose:r})=>t?e.jsxs("div",{className:`message ${a==="error"?"error":""}`,children:[e.jsx("span",{children:t}),a==="error"&&e.jsx("button",{className:"message-close",onClick:r,"aria-label":"Close message",children:"×"})]}):null,Te=({status:t,onClose:a})=>{if(!t)return null;const r=()=>{switch(t.status){case"pending":return"⏳";case"confirming":return"🔄";case"confirmed":return"✅";case"failed":return"❌";default:return"📋"}},s=()=>{switch(t.status){case"pending":return"#fbbf24";case"confirming":return"#3b82f6";case"confirmed":return"#10b981";case"failed":return"#ef4444";default:return"#6b7280"}},n=()=>{switch(t.status){case"pending":return"Waiting for user confirmation...";case"confirming":return`Confirming... (${t.confirmations} confirmation${t.confirmations!==1?"s":""})`;case"confirmed":return"Transaction confirmed!";case"failed":return t.error||"Transaction failed";default:return"Unknown status"}};return e.jsxs("div",{className:"transaction-status",style:{borderLeftColor:s()},children:[e.jsxs("div",{className:"transaction-header",children:[e.jsx("span",{className:"status-icon",children:r()}),e.jsx("span",{className:"status-text",children:n()}),a&&(t.status==="confirmed"||t.status==="failed")&&e.jsx("button",{className:"close-btn",onClick:a,children:"×"})]}),t.hash&&e.jsxs("div",{className:"transaction-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Transaction Hash:"}),e.jsxs("a",{href:`https://sepolia.etherscan.io/tx/${t.hash}`,target:"_blank",rel:"noopener noreferrer",className:"transaction-link",children:[t.hash.slice(0,10),"...",t.hash.slice(-8)]})]}),t.blockNumber&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Block Number:"}),e.jsx("span",{className:"detail-value",children:t.blockNumber})]}),t.gasUsed&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Gas Used:"}),e.jsx("span",{className:"detail-value",children:parseInt(t.gasUsed).toLocaleString()})]}),t.effectiveGasPrice&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Gas Price:"}),e.jsxs("span",{className:"detail-value",children:[parseFloat(t.effectiveGasPrice).toFixed(2)," gwei"]})]})]}),t.status==="pending"&&e.jsxs("div",{className:"pending-info",children:[e.jsx("p",{children:"Please confirm the transaction in your MetaMask wallet."}),e.jsxs("div",{className:"loading-dots",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]}),t.status==="confirming"&&e.jsxs("div",{className:"confirming-info",children:[e.jsx("p",{children:"Transaction is being processed on the Sepolia network."}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(t.confirmations*100,100)}%`}})})]})]})},ke=()=>e.jsxs("div",{className:"footer",children:[e.jsx("p",{children:"🛡️ All data encrypted using Zama's FHE technology"}),e.jsx("p",{children:"Privacy-first credit scoring on Sepolia testnet"})]}),Fe=()=>{const[t,a]=h.useState(null),[r,s]=h.useState(null),[n,c]=h.useState(null),[u,o]=h.useState(!1),[m,j]=h.useState(!1),[y,N]=h.useState("0"),[P,C]=h.useState(""),[F,f]=h.useState("");h.useEffect(()=>{if(D(),window.ethereum){const i=g=>{console.log("👤 Account changed:",g[0]||"disconnected"),g.length===0?A():g[0]!==t&&(a(g[0]),p(g[0]))},x=g=>{console.log("🌐 Chain changed:",g),C(g),b(g),g!==T&&console.warn("⚠️ Not connected to Sepolia testnet")},w=g=>{console.log("🔗 Wallet connected:",g),D()},v=()=>{console.log("❌ Wallet disconnected"),A()};return window.ethereum.on("accountsChanged",i),window.ethereum.on("chainChanged",x),window.ethereum.on("connect",w),window.ethereum.on("disconnect",v),()=>{var g,I,M,R;(g=window.ethereum)==null||g.removeListener("accountsChanged",i),(I=window.ethereum)==null||I.removeListener("chainChanged",x),(M=window.ethereum)==null||M.removeListener("connect",w),(R=window.ethereum)==null||R.removeListener("disconnect",v)}}},[t]);const p=h.useCallback(async i=>{if(!(!window.ethereum||!i))try{const w=await new O(window.ethereum).getBalance(i),v=J(w);N(parseFloat(v).toFixed(4))}catch(x){console.error("Failed to update account info:",x),N("0")}},[]),b=h.useCallback(i=>{f({"0x1":"Ethereum Mainnet","0xaa36a7":"Sepolia Testnet","0x5":"Goerli Testnet","0x7a69":"Hardhat Local"}[i]||`Unknown Network (${i})`)},[]),D=async()=>{if(!window.ethereum){console.log("🚫 MetaMask not detected");return}try{console.log("🔍 Checking existing wallet connection...");const i=await window.ethereum.request({method:"eth_accounts"});if(i.length>0){console.log("✅ Wallet already connected:",i[0]);const x=await window.ethereum.request({method:"eth_chainId"});C(x),b(x);const w=new O(window.ethereum),v=await w.getSigner();s(w),c(v),a(i[0]),j(!0),await p(i[0])}}catch(i){console.error("❌ Error checking wallet connection:",i)}},_=async()=>{if(!window.ethereum)throw new Error("🚫 MetaMask not detected! Please install MetaMask to use this DApp.");try{o(!0),console.log("🔗 Requesting wallet connection...");const i=await window.ethereum.request({method:"eth_requestAccounts"});if(i.length===0)throw new Error("❌ No accounts found. Please unlock MetaMask.");console.log("✅ Account connected:",i[0]);const x=await window.ethereum.request({method:"eth_chainId"});console.log("🌐 Current network:",x),C(x),b(x),x!==T&&(console.log("⚠️ Not on Sepolia, attempting to switch..."),await $()),console.log("📡 Initializing Web3 provider...");const w=new O(window.ethereum),v=await w.getSigner();if((await v.getAddress()).toLowerCase()!==i[0].toLowerCase())throw new Error("❌ Signer address mismatch");s(w),c(v),a(i[0]),j(!0),await p(i[0]),console.log("🎉 Wallet connection successful!")}catch(i){throw console.error("❌ Wallet connection failed:",i),j(!1),i}finally{o(!1)}},$=async()=>{try{console.log("🔄 Switching to Sepolia testnet...");try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:T}]}),console.log("✅ Successfully switched to Sepolia"),C(T),b(T)}catch(i){if(console.log("Switch error code:",i.code),i.code===4902)console.log("➕ Adding Sepolia network to MetaMask..."),await window.ethereum.request({method:"wallet_addEthereumChain",params:[ve]}),console.log("✅ Sepolia network added successfully"),C(T),b(T);else throw i.code===4001?new Error("❌ User rejected network switch. Please switch to Sepolia testnet manually."):i}}catch(i){throw console.error("❌ Error switching to Sepolia:",i),new Error(`Failed to switch to Sepolia testnet: ${i.message}`)}},A=()=>{console.log("🔌 Disconnecting wallet..."),a(null),s(null),c(null),j(!1),N("0"),C(""),f("")};return{account:t,provider:r,signer:n,loading:u,isConnected:m,balance:y,chainId:P,networkName:F,connectWallet:_,disconnect:A,switchToSepolia:$,requestPermissions:async()=>{try{const i=await window.ethereum.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]});return console.log("🔑 Permissions granted:",i),i}catch(i){throw console.error("❌ Permission request failed:",i),i}},updateAccountInfo:p}},Ae=({isOpen:t,onClose:a})=>{const[r,s]=h.useState("flow");return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"🔍 MetaMask Transaction Implementation Principles"}),e.jsx("button",{className:"modal-close",onClick:a,children:"✕"})]}),e.jsxs("div",{className:"modal-tabs",children:[e.jsx("button",{className:`tab-btn ${r==="flow"?"active":""}`,onClick:()=>s("flow"),children:"Contract Interaction Flow"}),e.jsx("button",{className:`tab-btn ${r==="trigger"?"active":""}`,onClick:()=>s("trigger"),children:"Trigger Mechanism"}),e.jsx("button",{className:`tab-btn ${r==="state"?"active":""}`,onClick:()=>s("state"),children:"State Management"})]}),e.jsxs("div",{className:"modal-body",children:[r==="flow"&&e.jsxs("div",{className:"explanation-section",children:[e.jsx("h3",{children:"📋 Contract Interaction Flow:"}),e.jsxs("div",{className:"flow-steps",children:[e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"1"}),e.jsx("span",{className:"step-text",children:"User clicks button"})]}),e.jsx("div",{className:"flow-arrow",children:"→"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"2"}),e.jsx("span",{className:"step-text",children:"Call contract method"})]}),e.jsx("div",{className:"flow-arrow",children:"→"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"3"}),e.jsx("span",{className:"step-text",children:"ethers.js sends transaction"})]}),e.jsx("div",{className:"flow-arrow",children:"→"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"4"}),e.jsx("span",{className:"step-text",children:"MetaMask popup confirmation"})]}),e.jsx("div",{className:"flow-arrow",children:"→"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("span",{className:"step-number",children:"5"}),e.jsx("span",{className:"step-text",children:"Blockchain execution"})]})]})]}),r==="trigger"&&e.jsxs("div",{className:"explanation-section",children:[e.jsx("h3",{children:"⚡ Trigger Mechanism:"}),e.jsxs("ol",{className:"numbered-list",children:[e.jsx("li",{children:"When contract method is called, ethers.js constructs the transaction"}),e.jsx("li",{children:"Because contract instance uses signer, ethers.js knows user signature is required"}),e.jsx("li",{children:"This automatically triggers MetaMask transaction confirmation popup"}),e.jsx("li",{children:"After user confirmation, transaction is sent to Sepolia testnet"}),e.jsxs("li",{children:[e.jsx("code",{children:"tx.wait()"})," waits for transaction to be mined and confirmed"]})]})]}),r==="state"&&e.jsxs("div",{className:"explanation-section",children:[e.jsx("h3",{children:"🔄 State Management:"}),e.jsxs("ul",{className:"bullet-list",children:[e.jsx("li",{children:"Display loading state during transaction processing"}),e.jsx("li",{children:"Update UI prompts and user feedback"}),e.jsx("li",{children:"Wait for blockchain confirmation"}),e.jsx("li",{children:"Refresh page state after transaction completion"})]})]}),e.jsxs("div",{className:"technical-summary",children:[e.jsx("h4",{children:"💡 Technical Implementation:"}),e.jsx("p",{children:"Interaction with smart contracts is handled through ethers.js, with MetaMask as the wallet provider automatically handling transaction signing and sending."})]})]})]})}):null},Ie=t=>{const[a,r]=h.useState(null),[s,n]=h.useState(!1);h.useEffect(()=>{t&&window.ethereum?c():r(null)},[t]);const c=async()=>{try{n(!0);const o=await new O(window.ethereum).getSigner(),m=new oe(xe,we,o);r(m)}catch(u){console.error("Failed to initialize contract:",u),r(null)}finally{n(!1)}};return{contract:a,loading:s}};class Me{constructor(a){L(this,"provider");this.provider=a}async trackTransaction(a,r){console.log("📡 Tracking transaction:",a),r({hash:a,status:"pending",confirmations:0});try{const s=await this.provider.waitForTransaction(a,1);if(!s)throw new Error("Transaction receipt not found");return console.log("✅ Transaction confirmed:",{hash:a,blockNumber:s.blockNumber,gasUsed:s.gasUsed.toString(),status:s.status}),r({hash:a,status:s.status===1?"confirmed":"failed",confirmations:1,gasUsed:H(s.gasUsed,"wei"),effectiveGasPrice:s.gasPrice?H(s.gasPrice,"gwei"):void 0,blockNumber:s.blockNumber}),s}catch(s){throw console.error("❌ Transaction tracking failed:",s),r({hash:a,status:"failed",confirmations:0,error:s.message}),s}}}class Le{constructor(a){L(this,"provider");this.provider=a}async estimateContractCall(a,r,s=[]){try{console.log(`⛽ Estimating gas for ${r}...`);const n=await this.provider.getFeeData();console.log("💰 Fee data:",{gasPrice:n.gasPrice?H(n.gasPrice,"gwei"):"null",maxFeePerGas:n.maxFeePerGas?H(n.maxFeePerGas,"gwei"):"null",maxPriorityFeePerGas:n.maxPriorityFeePerGas?H(n.maxPriorityFeePerGas,"gwei"):"null"});const c=await a[r].estimateGas(...s);console.log(`📊 Estimated gas limit: ${c.toString()}`);const u=c*BigInt(120)/BigInt(100);let o=n.gasPrice||BigInt(0),m=n.maxFeePerGas,j=n.maxPriorityFeePerGas;!m&&o>BigInt(0)&&(m=o);const y=u*(m||o),N=J(y);return console.log(`💸 Estimated cost: ${N} ETH`),{gasLimit:u,gasPrice:o,maxFeePerGas:m||void 0,maxPriorityFeePerGas:j||void 0,estimatedCost:parseFloat(N).toFixed(6)}}catch(n){return console.error(`❌ Gas estimation failed for ${r}:`,n),{gasLimit:BigInt(2e5),gasPrice:BigInt(ie("20","gwei")),estimatedCost:"0.004"}}}}class _e{constructor(a){L(this,"provider");L(this,"gasEstimator");L(this,"transactionTracker");this.provider=a,this.gasEstimator=new Le(a),this.transactionTracker=new Me(a)}async executeTransaction(a,r,s=[],n,c={}){var m,j,y,N,P,C,F;const{confirmations:u=1,timeout:o=3e5}=c;try{console.log(`🚀 Executing transaction: ${r}`),console.log("📝 Arguments:",s);const f=await this.gasEstimator.estimateContractCall(a,r,s);console.log("⛽ Gas estimate:",f),n({status:"pending",confirmations:0}),console.log("📤 Sending transaction to blockchain...");const p=await a[r](...s,{gasLimit:f.gasLimit,maxFeePerGas:f.maxFeePerGas,maxPriorityFeePerGas:f.maxPriorityFeePerGas,...f.gasPrice&&!f.maxFeePerGas?{gasPrice:f.gasPrice}:{}});console.log("✅ Transaction sent:",p.hash),console.log("📋 Transaction details:",{to:p.to,value:((m=p.value)==null?void 0:m.toString())||"0",gasLimit:((j=p.gasLimit)==null?void 0:j.toString())||"unknown",gasPrice:(y=p.gasPrice)==null?void 0:y.toString(),maxFeePerGas:(N=p.maxFeePerGas)==null?void 0:N.toString(),nonce:p.nonce});const b=await this.transactionTracker.trackTransaction(p.hash,n);return console.log("🎉 Transaction completed successfully!"),b}catch(f){console.error(`❌ Transaction execution failed for ${r}:`,f);let p=f.message;throw f.code===4001?p="Transaction cancelled by user":f.code===-32603?p="Transaction failed - insufficient funds or contract error":(P=f.message)!=null&&P.includes("insufficient funds")?p="Insufficient ETH balance for gas fees":(C=f.message)!=null&&C.includes("user rejected")?p="Transaction rejected by user":(F=f.message)!=null&&F.includes("execution reverted")&&(p="Contract execution failed - check your data"),n({status:"failed",confirmations:0,error:p}),new Error(p)}}}function Re(){const{account:t,isConnected:a,connectWallet:r,balance:s,chainId:n,networkName:c,loading:u,provider:o}=Fe(),{contract:m,loading:j}=Ie(t),[y,N]=h.useState({income:"",debt:"",age:"",creditHistory:"",paymentHistory:""}),[P,C]=h.useState({hasSubmitted:!1,isEvaluated:!1,canApprove:!1}),[F,f]=h.useState(0),[p,b]=h.useState(!1),[D,_]=h.useState(""),[$,A]=h.useState(!1),[z,i]=h.useState("info"),[x,w]=h.useState(null),[v,g]=h.useState(null);h.useEffect(()=>{if(o){const l=new _e(o);g(l)}},[o]),h.useEffect(()=>{m&&t&&(M(),R())},[m,t]);const I=()=>{w(null)},M=async()=>{if(!(!m||!t))try{const l=await m.hasSubmittedCreditData(t),S=await m.isCreditEvaluated(t);C({hasSubmitted:l,isEvaluated:S,canApprove:S})}catch(l){console.error("Failed to update user status:",l)}},R=async()=>{if(m)try{const l=await m.getEvaluationStats();f(Number(l))}catch(l){console.error("Failed to update stats:",l)}},V=async()=>{if(!m||!v){d("Please connect your wallet first!","error");return}const l=parseInt(y.income),S=parseInt(y.debt),k=parseInt(y.age),B=parseInt(y.creditHistory),q=parseInt(y.paymentHistory);if(!l||S===void 0||!k||B===void 0||!q){d("Please fill in all fields!","error");return}if(k<18||k>100){d("Age must be between 18 and 100!","error");return}if(q<1||q>10){d("Payment history score must be between 1 and 10!","error");return}if(l<=0||S<0||B<0){d("Invalid financial data entered!","error");return}if(parseFloat(s)===0){d("Insufficient ETH balance to pay for gas fees. Please add Sepolia ETH to your wallet.","error");return}try{b(!0),I(),d("Preparing transaction..."),console.log("🚀 Starting credit data submission transaction"),console.log("📋 Data:",{income:l,debt:S,age:k,creditHistory:B,paymentHistory:q}),await v.executeTransaction(m,"submitCreditData",[l,S,k,B,q],E=>{console.log("📊 Transaction status update:",E),w(E),E.status==="pending"?d("Transaction sent! Please confirm in MetaMask..."):E.status==="confirming"?d(`Transaction confirming... (${E.confirmations} confirmations)`):E.status==="confirmed"?d("Credit data successfully submitted to blockchain! 🟢"):E.status==="failed"&&d(E.error||"Transaction failed","error")}),N({income:"",debt:"",age:"",creditHistory:"",paymentHistory:""}),await M(),console.log("✅ Credit data submission completed successfully")}catch(E){console.error("❌ Submit credit data failed:",E),d(E.message||"Failed to submit credit data. Please try again.","error")}finally{b(!1)}},X=async()=>{if(!m||!t||!v){d("Please ensure wallet and contract are connected!","error");return}if(parseFloat(s)===0){d("Insufficient ETH balance to pay for gas fees.","error");return}try{b(!0),I(),d("Preparing credit evaluation..."),console.log("🧠 Starting credit evaluation transaction for:",t),await v.executeTransaction(m,"evaluateCreditScore",[t],l=>{console.log("📊 Evaluation status update:",l),w(l),l.status==="pending"?d("Transaction sent! Please confirm in MetaMask..."):l.status==="confirming"?d("Computing encrypted credit score..."):l.status==="confirmed"?d("Credit evaluation completed using homomorphic encryption! 🟢"):l.status==="failed"&&d(l.error||"Evaluation failed","error")}),await M(),await R(),console.log("✅ Credit evaluation completed successfully")}catch(l){console.error("❌ Credit evaluation failed:",l),d(l.message||"Failed to evaluate credit score. Please try again.","error")}finally{b(!1)}},ee=async()=>{if(!m||!v){d("Please ensure wallet and contract are connected!","error");return}if(parseFloat(s)===0){d("Insufficient ETH balance to pay for gas fees.","error");return}try{b(!0),I(),d("Preparing loan approval request..."),console.log("💰 Starting loan approval request transaction"),await v.executeTransaction(m,"requestLoanApproval",[],l=>{console.log("📊 Approval status update:",l),w(l),l.status==="pending"?d("Transaction sent! Please confirm in MetaMask..."):l.status==="confirming"?d("Processing loan approval request..."):l.status==="confirmed"?d("Loan approval request submitted successfully! 🟢"):l.status==="failed"&&d(l.error||"Approval request failed","error")}),console.log("✅ Loan approval request completed successfully")}catch(l){console.error("❌ Loan approval request failed:",l),d(l.message||"Failed to request loan approval. Please try again.","error")}finally{b(!1)}},d=(l,S="info")=>{_(l),i(S),S!=="error"&&setTimeout(()=>{_("")},5e3)},te=(l,S)=>{N(k=>({...k,[l]:S}))},W=u||j||p;return e.jsxs("div",{className:"container",children:[e.jsx(pe,{}),e.jsx(fe,{userStatus:P,totalEvaluations:F,balance:s,networkName:c,chainId:n}),e.jsx("div",{className:"explanation-btn-container",children:e.jsx("button",{className:"btn btn-accent explanation-btn",onClick:()=>A(!0),children:"📚 Transaction Explanation"})}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"wallet-address",children:["Connected: ",t==null?void 0:t.slice(0,6),"...",t==null?void 0:t.slice(-4)]}),!P.hasSubmitted&&e.jsx(Ce,{creditData:y,setCreditData:N,setPreset:te,onSubmit:V,loading:W}),e.jsx(Ee,{userStatus:P,onEvaluate:X,onRequestApproval:ee,loading:W})]}):e.jsx(ge,{onConnect:r,loading:W}),e.jsx(Pe,{message:D,type:z,onClose:()=>_("")}),e.jsx(Te,{status:x,onClose:()=>w(null)}),e.jsx(Ae,{isOpen:$,onClose:()=>A(!1)}),e.jsx(ke,{})]})}Y.createRoot(document.getElementById("root")).render(e.jsx(re.StrictMode,{children:e.jsx(Re,{})}));
